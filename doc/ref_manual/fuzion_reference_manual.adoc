// This file is part of the Fuzion language implementation.
//
// The Fuzion language implementation is free software: you can redistribute it
// and/or modify it under the terms of the GNU General Public License as published
// by the Free Software Foundation, version 3 of the License.
//
// The Fuzion language implementation is distributed in the hope that it will be
// useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
// License for more details.
//
// You should have received a copy of the GNU General Public License along with The
// Fuzion language implementation.  If not, see <https://www.gnu.org/licenses/>.
//
//
//
// -----------------------------------------------------------------------
//
//  Tokiwa Software GmbH, Germany
//
//  ASCIIdoc source of the Fuzion Language Reference Manual
//
// -----------------------------------------------------------------------

// This is the main asciidoc input file that defines the overall structure of the
// reference manual.
//
= Fuzion Reference Manual [DRAFT]
The Fuzion Team <info@tokiwa.software>
include::../../version.txt[]
:title-logo-image: image:../../assets/logo.png[top=5%,align=center,pdfwidth=1.5cm]
:doctype: book
:description: Fuzion Language Reference Manual
:sectanchors:
:url-repo: https://github.com/tokiwa-software/fuzion/
:sectnums:
:icons: font
:toc: macro

toc::[]

== About this Document

=== Audience

CAUTION: *NYI*: Audience spec missing!

=== Conventions

This is work in progress. Areas where information is known to be preliminary,
missing or wrong might be marked as follows:

CAUTION: *NYI*: This spec is work in progress!

Generally, *NYI* is used in this document, as well as through any other files
related to the Fuzion project, to mark sections that need further work or future
enhancements.  This is often equivalent to comments starting *TODO* or similar
used in other projects.

The specification contains a number of rules that must be implemented by the
language implementations. These rules are identified by identifiers such as
*DOMAIN_DETAIL*. Rules are shown as follows:

:RULE_SRC: doc/ref_manual/demo_rule.txt
:RULE_ID: DOMAIN_DETAIL
include::rule.adoc[]


== Input

=== Input Sources

Fuzion source code input may come from different sources including source code
files, streams such as the standard input stream of a Unix shell command,
interactive input in an interactive Read-Eval-Print-Loop (indexterm2:[REPL]), command line arguments, etc.

For source code files, the following rule applies:

:RULE_SRC: src/dev/flang/fe/SourceModule.java
:RULE_ID: SRCF_DOTFZ
include::rule.adoc[]

=== Directories

Source files may be organized in a hierarchy of directories.  Source files in
sub-directories are automatically considered as input only if corresponding
outer features exist:

:RULE_SRC: src/dev/flang/fe/SourceModule.java
:RULE_ID: SRCF_DIR
include::rule.adoc[]


=== Input encoding

Fuzion input sources use UTF8 encoding.

include::{GENERATED}/doc/unicode_version.adoc[]

CAUTION: NYI: Actual Unicode version has not been fixed yet!

:RULE_SRC: src/dev/flang/util/SourceFile.java
:RULE_ID: SRCF_UTF8
include::rule.adoc[]



== Syntax

=== Lexical Tokens

The Unicode code points of the input data are grouped into lexical tokens.  The
main groups of tokens are white space, reserved keywords, identifiers, literals
and comments.  The following sub-sections describe these in detail.

==== Unsupported Code Points

[#unsupported_code_points]
Certain code points are not supported and will not be converted into tokens by
the lexer but instead result in an error when processing input data containing
these code points. The following code points are ((unsupported code points)).

// [none] means no bullet points
[none]
include::{GENERATED}/doc/codepoints_illegal.adoc[]

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_LEGALCP
include::rule.adoc[]

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_UNUSEDCP
include::rule.adoc[]

==== White Space

[#whitespace_code_points]
White space are code points that are ignored when creating tokens. Nevertheless,
white space often plays an important role in separating tokens such as a
keyword from an identifier as in `if&nbsp;condition`.

The following code points in the input are considered ((white space)).

// [none] means no bullet points
[none]
include::{GENERATED}/doc/codepoints_white_space.adoc[]

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_WHITESPACE
include::rule.adoc[]

Even though white space does directly create tokens, the Fuzion language parser
is affected by the presence of white space, e.g., to group blocks of code by a
common level of indentation or to separate actual arguments provided to a call.

==== Code point categories

[#fuzion_letter]
The following code points are considered Fuzion letters:

// [none] means no bullet points
[none]
include::{GENERATED}/doc/codepoints_letter.adoc[]

[#fuzion_digit]
The following code points are considered Fuzion digits:

// [none] means no bullet points
[none]
include::{GENERATED}/doc/codepoints_digit.adoc[]

[#fuzion_numeric]
The following code points are considered Fuzion numerics:

// [none] means no bullet points
[none]
include::{GENERATED}/doc/codepoints_numeric.adoc[]

[#fuzion_op]
The following code points are considered Fuzion operator code points:

// [none] means no bullet points
[none]
include::{GENERATED}/doc/codepoints_op.adoc[]

==== Lines and Columns

Each code point in an xref:input_source[Input sources] has an associated line
and column. The first code point is in line `1` column `1`. Each code point that
is not following a end of line marker is part of the same line as the previous
code point and the line of the previous code point incremented by `1`.

A code point that follows an end of line marker gets its line number increased
by `1` and its column reset to `1`.

:RULE_SRC: src/dev/flang/util/SourceFile.java
:RULE_ID: LEXR_NEWLINE
include::rule.adoc[]

NOTE: In Fuzion, the lines and columns are not only relevant when referring to code
location, e.g., when reporting error in the source code, but also have an effect
on how code is parsed: In certain contexts such as in a one-line comment or at a
given indentation level, the position of code affects the way the code is
parsed.

==== Keywords

[#fuzion_keyword]
The Fuzion grammar knows the following reserved keyword:

====
include::{GENERATED}/doc/keywords.adoc[]
====

==== Identifiers

[#fuzion_identifier]
Identifiers in Fuzion are used to attach names to xref:fuzion_feature[Fuzion
features].  Identifiers may contain a large variety of letters, digits and
numeric symbols, they must start with a letter.

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_IDENT1
include::rule.adoc[]

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_IDENT2
include::rule.adoc[]

==== Operators

[#fuzion_operator]
Similar to an xref:fuzion_identifier[identifier], a Fuzion operator may be part of
a name of a xref:fuzion_feature[Fuzion features].  Such features permit a call syntax
that uses infix, prefix or postfix notation.

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_OPER1
include::rule.adoc[]

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_OPER2
include::rule.adoc[]

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_OPER3
include::rule.adoc[]

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_OPER4
include::rule.adoc[]

Examples for legal operators are `+`, `%%%`, `??`, `∀`, `∙`, `---` `>`, `/-/`, `*//`, `*#`.

Examples for non-operators are `?`, `//`, `#*`.

==== Comments

Fuzion offers three kinds of comments: single line comments that start with
either `#` or `//` and that extend to the end of the source code line, and
nestable comments using `/\*` and `\*/` that may extends over several lines of
code.

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_COMMENT1
include::rule.adoc[]

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_COMMENT2
include::rule.adoc[]

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: LEXR_COMMENT3
include::rule.adoc[]

Examples of valid comments areas

    i := 42     # this is a comment
    this is not a comment
    j := 32168  // this is also a comment
    k := /* this is a comment */ 23
    /* this /* comment /* is */ nested */ */
    l := "not a comment, but a string literal"
    /* this
    /* comment
    /* extends */
       over several
    */ lines */
    m := l

==== Literals

CAUTION: *NYI*: Text Missing

===== Numeric Literals

CAUTION: *NYI*: Text Missing

===== String Literals

[#string_literal]
CAUTION: *NYI*: Text Missing

String literals support the following escape sequence to include special characters:

====
include::{GENERATED}/doc/stringEscapes.adoc[]
====



=== Grammar

:RULE_SRC: src/dev/flang/parser/Lexer.java
:RULE_ID: PARS_SYNTAX
include::rule.adoc[]

CAUTION: *NYI*: Text Missing

== Semantics

CAUTION: *NYI*: Text Missing

[appendix]
== Glossary

[#fuzion_abstract]
((Abstract Feature)):: CAUTION: *NYI*: Text Missing

((Argument)):: CAUTION: *NYI*: Text Missing

[#fuzion_choice]
((Choice)):: CAUTION: *NYI*: Text Missing

[#fuzion_constructor]
((Constructor)):: CAUTION: *NYI*: Text Missing

((Clazz)):: CAUTION: *NYI*: Text Missing

[#fuzion_feature]
((Feature)):: A feature is the most fundamental entity of Fuzion.  A feature can
be declared and can be called.  Features generalize fairly different concepts
found in other programming languages such as functions, methods, constructors,
classes, structs, records, packages, interfaces, fields, and local variables.
A Fuzion feature may be one of the following variants: a xref:fuzion_constructor[constructor],
a xref:fuzion_function[function], a xref:fuzion_field[field], a xref:fuzion_choice[choice],
a xref:fuzion_typeparameter[type parameter], an xref:fuzion_abstract[abstract feature],
an xref:fuzion_intrinsic[intrinsic], a xref:fuzion_native[native feature].

[#fuzion_field]
((Field)):: CAUTION: *NYI*: Text Missing

[#fuzion_function]
((Function)):: CAUTION: *NYI*: Text Missing

[#fuzion_intrinsic]
((Intrinsic Feature)):: CAUTION: *NYI*: Text Missing

[#fuzion_native]
((Native Feature)):: CAUTION: *NYI*: Text Missing

[#input_source]
((Input Source)):: An input source is a stream of bytes that contains Fuzion
code that is used as an input for tools like Fuzion compilers.

((Routine)):: CAUTION: *NYI*: Text Missing

((Type)):: CAUTION: *NYI*: Text Missing

[#fuzion_typeparameter]
((Type Parameter)):: CAUTION: *NYI*: Text Missing

[appendix]
== File Formats

=== FUM -- Fuzion Module File

include::{GENERATED}/doc/fum_file.adoc[leveloffset=+0,lines=8..-1]


[appendix]
== BNF Grammar
The following shows the Grammar using a notation similar to Backus–Naur form <<bnf>>.
----
include::{FUZION_EBNF}[]
----

[bibliography]
== Bibliography

* [[[bnf]]] Backus, J. W. (1959). "The syntax and semantics of the proposed
  international algebraic language of the Zurich ACM-GAMM
  Conference". Proceedings of the International Conference on Information
  Processing. UNESCO. pp. 125–132. https://www.softwarepreservation.org/projects/ALGOL/paper/Backus-Syntax_and_Semantics_of_Proposed_IAL.pdf[]

[index]
== Index

LocalWords:  Fuzion MERCHANTABILITY ASCIIdoc SRCF DOTFZ UTF LEXR LEGALCP fuzion
LocalWords:  UNUSEDCP whitespace IDENT OPER
